---
description: Nintroller project structure and organization patterns
globs:
alwaysApply: true
---

# Nintroller Project Structure

This rule outlines the directory structure and organization of the Nintroller project - a retro-themed NES controller simulator built with Next.js, TypeScript, and React.

## Project Overview

**Nintroller** is an interactive Nintendo (NES) controller simulator that provides:

- Real-time input logging with timestamps and source tracking
- Client-side cheat code detection (Konami Code, ABBA, etc.)
- Responsive design (mobile emulator-style, desktop classic layout)
- Retro terminal/CRT aesthetic with emerald theme
- Full accessibility support (ARIA, keyboard navigation, focus management)
- Comprehensive test coverage (Jest + Testing Library)

## Root Directory Structure

```
nintroller/
â”œâ”€â”€ app/                    # ğŸš€ Next.js 16 App Router directory
â”œâ”€â”€ __tests__/              # ğŸ§ª Test files (mirrors source structure)
â”œâ”€â”€ public/                 # ğŸŒ Static assets (images, fonts, etc.)
â”œâ”€â”€ package.json            # ğŸ“‹ Project dependencies & scripts
â”œâ”€â”€ tsconfig.json           # ğŸ“˜ TypeScript configuration
â”œâ”€â”€ jest.config.mjs         # ğŸ§ª Jest test configuration
â”œâ”€â”€ eslint.config.mjs       # ğŸ” ESLint configuration
â”œâ”€â”€ next.config.ts          # âš™ï¸ Next.js configuration
â”œâ”€â”€ postcss.config.mjs      # ğŸ¨ PostCSS configuration
â””â”€â”€ README.md               # ğŸ“– Project documentation
```

## App Directory (`/app/`)

**Purpose**: Next.js 16 App Router structure with all application code.

```
app/
â”œâ”€â”€ api/                    # ğŸ”Œ API routes
â”‚   â””â”€â”€ cheats/
â”‚       â””â”€â”€ route.ts        # Cheat detection endpoint (deprecated, client-side by default)
â”‚
â”œâ”€â”€ components/            # ğŸ¨ React components (feature-based organization)
â”‚   â”œâ”€â”€ ControllerPlayground/  # Main orchestrator component
â”‚   â”‚   â””â”€â”€ index.tsx         # Manages controller, modals, FABs, cheat detection
â”‚   â”‚
â”‚   â”œâ”€â”€ NESController/        # NES Controller UI component
â”‚   â”‚   â”œâ”€â”€ index.tsx         # Re-export shim (exports NESController + types)
â”‚   â”‚   â”œâ”€â”€ NESController.tsx  # Main controller UI (mobile/desktop layouts)
â”‚   â”‚   â”œâ”€â”€ BaseButton.tsx    # Reusable button component (pointer capture, accessibility)
â”‚   â”‚   â””â”€â”€ keyboard.ts       # Keyboard event handlers & mappings
â”‚   â”‚
â”‚   â”œâ”€â”€ InputLog/             # Input logging system
â”‚   â”‚   â””â”€â”€ index.tsx         # Component + Context Provider (InputLogProvider, useInputLog)
â”‚   â”‚
â”‚   â”œâ”€â”€ InputLogSidebar/      # Right sidebar (desktop) / modal (mobile)
â”‚   â”‚   â””â”€â”€ index.tsx         # Responsive sidebar with FAB button
â”‚   â”‚
â”‚   â”œâ”€â”€ ObjectivesSidebar/    # Left sidebar for cheat objectives
â”‚   â”‚   â””â”€â”€ index.tsx         # Displays cheat list, progress, console cards
â”‚   â”‚
â”‚   â”œâ”€â”€ ControllerConsoleCards/  # Console-style info cards
â”‚   â”‚   â””â”€â”€ index.tsx            # Warning & help cards (NoCheatsWarningCard, DesktopInputHelpCard)
â”‚   â”‚
â”‚   â””â”€â”€ ui/                  # ğŸ¯ Reusable UI components
â”‚       â”œâ”€â”€ Button.tsx        # Button component (variants: primary, secondary, emerald)
â”‚       â”œâ”€â”€ IconButton/       # Icon button with FAB variant
â”‚       â”‚   â””â”€â”€ index.tsx
â”‚       â”œâ”€â”€ Modal/            # Accessible modal component
â”‚       â”‚   â”œâ”€â”€ index.tsx     # Modal wrapper (focus management, Escape key, backdrop)
â”‚       â”‚   â””â”€â”€ content/      # Modal content components
â”‚       â”‚       â”œâ”€â”€ WelcomeContent.tsx
â”‚       â”‚       â”œâ”€â”€ CheatContent.tsx
â”‚       â”‚       â”œâ”€â”€ ResetProgressContent.tsx
â”‚       â”‚       â””â”€â”€ index.tsx
â”‚       â””â”€â”€ index.tsx         # Re-export shim for UI components
â”‚
â”œâ”€â”€ hooks/                  # ğŸª Custom React hooks
â”‚   â”œâ”€â”€ index.ts            # Re-export shim for all hooks
â”‚   â”œâ”€â”€ useSidebarState.ts  # Sidebar state management (desktop init, mobile closing)
â”‚   â”œâ”€â”€ useEscapeKey.ts     # Escape key handler for modals/sidebars
â”‚   â”œâ”€â”€ useFocusManagement.ts  # Focus management between open/close buttons
â”‚   â”œâ”€â”€ useUnlockedCheats.ts   # Unlocked cheats state with localStorage persistence
â”‚   â””â”€â”€ useSidebarToggleEvents.ts  # Sidebar toggle event listeners (for FAB positioning)
â”‚
â”œâ”€â”€ lib/                    # ğŸ“š API abstraction layer
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ cheats.ts       # Server-side cheat detection abstraction (optional)
â”‚
â”œâ”€â”€ libs/                   # ğŸ§  Business logic libraries (pure functions)
â”‚   â””â”€â”€ cheats.ts           # Cheat definitions, detection algorithms, utilities
â”‚
â”œâ”€â”€ types/                  # ğŸ“˜ TypeScript type definitions
â”‚   â””â”€â”€ nes-controller.ts   # NES controller types (NESButton, InputSource, ButtonChangeEvent)
â”‚
â”œâ”€â”€ utils/                  # ğŸ› ï¸ Utility functions
â”‚   â””â”€â”€ index.ts            # cx(), prettyButtonName(), getOrCreateSessionId()
â”‚
â”œâ”€â”€ globals.css             # ğŸ¨ Global styles + Tailwind CSS + custom animations
â”œâ”€â”€ layout.tsx              # ğŸ“ Root layout (sidebars, providers, fonts, CRT overlay)
â”œâ”€â”€ page.tsx                # ğŸ  Home page (renders ControllerPlayground)
â””â”€â”€ favicon.ico             # ğŸ¯ Site favicon
```

## Tests Directory (`/__tests__/`)

**Purpose**: Test files organized to mirror source structure for easy navigation.

```
__tests__/
â”œâ”€â”€ components/             # ğŸ§ª React component tests
â”‚   â”œâ”€â”€ Button.test.tsx
â”‚   â”œâ”€â”€ IconButton.test.tsx
â”‚   â”œâ”€â”€ InputLog.test.tsx
â”‚   â”œâ”€â”€ InputLogSidebar.test.tsx
â”‚   â”œâ”€â”€ ObjectivesSidebar.test.tsx
â”‚   â”œâ”€â”€ ControllerPlayground.test.tsx
â”‚   â””â”€â”€ CheatModal.test.tsx
â”‚
â””â”€â”€ lib/                   # ğŸ§ª Utility/library tests
    â”œâ”€â”€ cheats.test.ts     # Cheat detection algorithm tests
    â”œâ”€â”€ keyboard.test.ts   # Keyboard mapping tests
    â””â”€â”€ utils.test.ts      # Utility function tests
```

## Public Directory (`/public/`)

**Purpose**: Static assets served at the root URL.

```
public/
â”œâ”€â”€ demo-desktop.png       # ğŸ“¸ Desktop demo screenshot
â””â”€â”€ [Next.js default SVGs] # file.svg, globe.svg, next.svg, vercel.svg, window.svg
```

## Key Configuration Files

### Package Management

- `package.json` - Project dependencies, scripts (dev, build, test, lint)
- `pnpm-lock.yaml` / `package-lock.json` - Lock files for dependency versions

### TypeScript

- `tsconfig.json` - TypeScript compiler configuration
  - Strict mode enabled
  - Path aliases: `@/*` â†’ `./*`
  - Next.js plugin integration

### Testing

- `jest.config.mjs` - Jest configuration
  - Next.js integration via `next/jest`
  - jsdom test environment
  - Path alias mapping
- `jest.setup.ts` - Test setup file (global mocks, test utilities)

### Code Quality

- `eslint.config.mjs` - ESLint configuration
  - Next.js core web vitals rules
  - TypeScript rules
  - Custom ignores for build artifacts

### Build & Styling

- `next.config.ts` - Next.js configuration
- `postcss.config.mjs` - PostCSS configuration (Tailwind CSS)
- `app/globals.css` - Global styles, Tailwind directives, custom animations

## Component Organization Patterns

### Feature Components (`/app/components/[Feature]/`)

- **Self-contained**: Each feature component lives in its own folder
- **Entry point**: `index.tsx` provides clean import path
- **Co-location**: Related files (types, utils) live in the same folder
- **Examples**: `NESController/`, `InputLog/`, `ControllerPlayground/`

### UI Components (`/app/components/ui/`)

- **Reusable**: Shared across the entire application
- **Variants**: Components support multiple variants (Button: primary, secondary, emerald)
- **Accessibility**: Built-in ARIA support, focus management
- **Composition**: Modal with content components pattern

### Component Structure Pattern

```typescript
// Standard component folder structure
[ComponentName]/
â”œâ”€â”€ index.tsx          # Main component or re-export shim
â”œâ”€â”€ [ComponentName].tsx # Implementation (if separate from index)
â”œâ”€â”€ [related].tsx      # Related components (e.g., BaseButton.tsx)
â””â”€â”€ [utils].ts        # Component-specific utilities (e.g., keyboard.ts)
```

## Hook Organization Patterns

### Custom Hooks (`/app/hooks/`)

- **Single responsibility**: Each hook handles one concern
- **Reusable**: Can be used across multiple components
- **Documented**: JSDoc comments explain purpose and usage
- **Type-safe**: Full TypeScript support with proper types

### Hook Categories

- **State management**: `useSidebarState`, `useUnlockedCheats`
- **Event handling**: `useEscapeKey`, `useSidebarToggleEvents`
- **UI utilities**: `useFocusManagement`

## Business Logic Organization

### Pure Functions (`/app/libs/`)

- **No React dependencies**: Can be used in any context
- **Testable**: Easy to unit test without React setup
- **Examples**: `cheats.ts` (detection algorithms, cheat definitions)

### API Abstractions (`/app/lib/api/`)

- **Encapsulation**: Abstracts API route calls
- **Type-safe**: Proper TypeScript types for requests/responses
- **Optional**: Used only when server-side detection is needed

## Type Organization

### Centralized Types (`/app/types/`)

- **Shared definitions**: Types used across multiple files
- **Domain-specific**: `nes-controller.ts` contains all NES-related types
- **Exported**: Re-exported via component index files for convenience

## Utility Organization

### Utilities (`/app/utils/`)

- **Pure functions**: No side effects (except localStorage utilities)
- **Common helpers**: `cx()` for className concatenation
- **Formatting**: `prettyButtonName()` for display
- **Client-side**: `getOrCreateSessionId()` for browser APIs

## File Naming Conventions

### Components

- **PascalCase**: `NESController.tsx`, `InputLogSidebar.tsx`
- **Descriptive**: Purpose clearly indicated in name
- **Folder = Component**: Component folder name matches main component

### Hooks

- **camelCase with "use" prefix**: `useSidebarState.ts`, `useEscapeKey.ts`
- **Descriptive**: Purpose clearly indicated in name

### Utilities & Libraries

- **camelCase**: `cheats.ts`, `keyboard.ts`
- **Descriptive**: Clear purpose indication
- **Index files**: `index.ts` for re-exports

### Tests

- **Component name + .test.tsx**: `Button.test.tsx`, `InputLog.test.tsx`
- **Mirrors source**: Test location mirrors source structure

### Types

- **kebab-case**: `nes-controller.ts`
- **Domain-specific**: Groups related types together

## Import Patterns

### Path Aliases

- **`@/app/...`**: Absolute imports from app directory
- **`@/...`**: Root-level imports (configured in tsconfig.json)

### Re-export Shims

```typescript
// Component index.tsx pattern
export { ComponentName } from "./ComponentName";
export type { TypeName } from "./types";

// Hooks index.ts pattern
export { useHookName } from "./useHookName";
```

### Import Organization

1. External dependencies (React, Next.js)
2. Internal types
3. Internal utilities
4. Internal components
5. Internal hooks

## Architecture Patterns

### State Management

- **React Context**: `InputLogProvider` for shared input log state
- **Local State**: `useState` for component-specific state
- **Custom Hooks**: Encapsulate complex state logic

### Communication Patterns

- **Props**: Parent-to-child communication
- **Context**: Shared state across component tree
- **Custom Events**: Cross-component communication (sidebar toggles, cheat unlocks)
- **Event-driven**: Decoupled components via window events

### Responsive Design

- **Mobile-first**: Base styles for mobile, `lg:` breakpoint for desktop
- **Conditional rendering**: Different layouts for mobile vs desktop
- **Sidebar pattern**: Modal on mobile, fixed sidebar on desktop

### Accessibility

- **ARIA attributes**: `aria-label`, `aria-modal`, `aria-pressed`
- **Keyboard navigation**: Full keyboard support for controller
- **Focus management**: Automatic focus on modal open/close
- **Screen readers**: Semantic HTML and ARIA labels

## Testing Patterns

### Test Organization

- **Mirrors source**: Test structure matches source structure
- **Co-location**: Tests live in `__tests__/` at root level
- **Component tests**: React Testing Library for component tests
- **Unit tests**: Jest for pure function tests

### Test Coverage

- **Components**: All major components have tests
- **Utilities**: All utility functions have tests
- **Business logic**: Cheat detection algorithms fully tested
- **Integration**: Component integration tests for user flows
